# 파이썬 추천 시스템 아키텍처

## 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        Frontend (React)                         │
│                     사용자 입력 인터페이스                        │
└─────────────────────┬───────────────────────────────────────────┘
                      │ HTTP POST Request
                      │ (사용자 선호도 데이터)
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Backend (Spring Boot)                        │
│                   API Gateway & 비즈니스 로직                    │
└─────────────────────┬───────────────────────────────────────────┘
                      │ HTTP Request
                      │ (JSON 데이터)
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                Python Recommendation Service                    │
│                     (Django REST Framework)                     │
└─────────────────────────────────────────────────────────────────┘
```

## Python 추천 서비스 내부 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                          API Layer                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              views.py (RecommendAPIView)                    │ │
│  │  • 요청 검증 (RecommendationRequestSerializer)              │ │
│  │  • 응답 포맷팅 (snake_case → camelCase)                     │ │
│  │  • 에러 핸들링                                              │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Service Layer                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │           recommendation.py (Main Orchestrator)             │ │
│  │  • generate_recommendation() - 전체 프로세스 총괄           │ │
│  │  • 사용자 입력 → 텍스트 변환                                │ │
│  │  • 결과 조합 및 반환                                        │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    AI Engine Layer                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    engine.py                                │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                  │ │
│  │  │  get_embedding  │  │ get_recommendation │                │ │
│  │  │                 │  │     _reason      │                  │ │
│  │  │ OpenAI API      │  │                 │                  │ │
│  │  │ text-embedding  │  │   GPT-4o-mini   │                  │ │
│  │  │   -3-small      │  │      RAG        │                  │ │
│  │  └─────────────────┘  └─────────────────┘                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                  Vector Store Layer                             │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                 vector_store.py                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                  │ │
│  │  │ _load_faiss_    │  │ similarity_     │                  │ │
│  │  │ index_and_      │  │ search          │                  │ │
│  │  │ metadata        │  │                 │                  │ │
│  │  │                 │  │ FAISS L2 검색   │                  │ │
│  │  │ 캐싱 최적화     │  │ k=3 유사 직업   │                  │ │
│  │  └─────────────────┘  └─────────────────┘                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Data Layer                                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    data/ 디렉토리                           │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                  │ │
│  │  │ vectorDB_index  │  │ metadata.json   │                  │ │
│  │  │    .faiss       │  │                 │                  │ │
│  │  │                 │  │ 직업 상세 정보  │                  │ │
│  │  │ 벡터 인덱스     │  │ (jobName, 등)   │                  │ │
│  │  │ 빠른 검색       │  │                 │                  │ │
│  │  └─────────────────┘  └─────────────────┘                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 데이터 플로우

```
1. 사용자 입력 (JSON)
   ↓
2. 텍스트 변환 (_concat_dict_values)
   ↓
3. 임베딩 생성 (OpenAI API)
   ↓
4. 벡터 검색 (FAISS)
   ↓
5. 메타데이터 매핑
   ↓
6. AI 추천 이유 생성 (GPT RAG)
   ↓
7. 결과 반환 (camelCase JSON)
```

## 주요 컴포넌트 역할

### 1. API Layer (views.py)
- **입력 검증**: RecommendationRequestSerializer
- **데이터 변환**: snake_case ↔ camelCase
- **에러 처리**: ValidationError, 500 에러 핸들링

### 2. Service Layer (recommendation.py)
- **프로세스 총괄**: generate_recommendation()
- **데이터 전처리**: 사용자 입력 → 검색 가능한 텍스트
- **결과 조합**: 벡터 검색 + AI 생성 이유

### 3. AI Engine (engine.py)
- **임베딩**: text-embedding-3-small 모델
- **RAG**: GPT-4o-mini로 개인화된 추천 이유 생성
- **API 관리**: OpenAI 클라이언트 초기화

### 4. Vector Store (vector_store.py)
- **데이터 로딩**: FAISS 인덱스 + 메타데이터 캐싱
- **유사도 검색**: L2 정규화 후 k=3 검색
- **결과 매핑**: 인덱스 → 직업 정보 변환

### 5. Data Layer
- **vectorDB_index.faiss**: 사전 구축된 직업 벡터 인덱스
- **metadata.json**: 직업별 상세 정보 (이름, 전망, 환경 등)

## 성능 최적화 특징

1. **캐싱**: FAISS 인덱스와 메타데이터를 메모리에 1회 로드
2. **배치 처리**: 여러 추천 이유를 병렬로 생성
3. **벡터 정규화**: L2 정규화로 검색 정확도 향상
4. **모델 선택**: 경량 임베딩 모델 사용으로 응답 속도 개선

## 확장 가능성

- **새로운 AI 모델**: engine.py에서 모델 교체 가능
- **다양한 벡터DB**: vector_store.py에서 FAISS 외 다른 DB 지원
- **추가 필터링**: 사용자 조건별 후처리 로직 추가
- **A/B 테스트**: 다양한 추천 알고리즘 비교 테스트